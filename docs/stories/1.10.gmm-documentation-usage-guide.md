# Story 1.10: GMM Documentation and Usage Guide

## Status

Draft

## Story

**As a** technical writer / research engineer,
**I want** to create comprehensive documentation for GMM functionality,
**so that** users understand how to configure, train, evaluate, and interpret GMM models.

## Acceptance Criteria

1. **GMM_XLNET_GUIDE.md created** following existing guide structure with comprehensive sections
2. **API_REFERENCE.md updated** with GMM configuration parameters
3. **MEMORY_TOKENS_GUIDE.md extended** with GMM architecture section
4. **Example script** created: `examples/train_with_gmm_memory.py`
5. **CLAUDE.md updated** with GMM quick reference
6. **README.md updated** mentioning GMM as advanced memory option

## Integration Verification

**IV1**: All existing documentation remains accurate with GMM code present
**IV2**: Documentation examples run without errors when copy-pasted
**IV3**: Links between documents remain valid (no broken references)

## Tasks / Subtasks

- [ ] Create GMM_XLNET_GUIDE.md (AC: 1)
  - [ ] Create `docs/guides/GMM_XLNET_GUIDE.md`
  - [ ] Section: Overview and Motivation
    - [ ] Explain flat memory problem
    - [ ] Introduce Mixture-of-Experts solution
    - [ ] Compare to existing memory systems
    - [ ] Research motivation and applications
  - [ ] Section: Architecture Overview
    - [ ] Explain k expert memories
    - [ ] Explain learnable gating network
    - [ ] Explain routing-modulated updates
    - [ ] Explain aggregated reads
    - [ ] Include component diagram
  - [ ] Section: Configuration Options
    - [ ] Document all GMMTrainingConfig parameters
    - [ ] Explain parameter effects and trade-offs
    - [ ] Provide preset configurations (small, balanced, large)
    - [ ] Include configuration examples
  - [ ] Section: Training GMM Models
    - [ ] Step-by-step training workflow
    - [ ] Configuration best practices
    - [ ] Hyperparameter tuning guidance
    - [ ] Common training issues and solutions
    - [ ] Include training script example
  - [ ] Section: Evaluating GMM Models
    - [ ] Evaluation workflow
    - [ ] Model loading from Hub
    - [ ] Metrics interpretation
    - [ ] Include evaluation script example
  - [ ] Section: Interpretability Analysis
    - [ ] Using GMMAnalyzer
    - [ ] Computing specialization metrics
    - [ ] Generating visualizations
    - [ ] Interpreting routing patterns
    - [ ] Include analysis script example
  - [ ] Section: Troubleshooting
    - [ ] Common errors and solutions
    - [ ] Performance optimization tips
    - [ ] Debugging routing issues
    - [ ] FAQ
- [ ] Update API_REFERENCE.md (AC: 2)
  - [ ] Read existing `docs/api/API_REFERENCE.md`
  - [ ] Add section: "GMM Configuration Parameters"
  - [ ] Document GMMTrainingConfig fields
  - [ ] Document GMMXLNetForQA methods
  - [ ] Document GMMAnalyzer methods
  - [ ] Include parameter types, defaults, descriptions
  - [ ] Add usage examples for each API
- [ ] Extend MEMORY_TOKENS_GUIDE.md (AC: 3)
  - [ ] Read existing `docs/guides/MEMORY_TOKENS_GUIDE.md`
  - [ ] Add section: "GMM Memory Architecture"
  - [ ] Explain how GMM extends token-based memory
  - [ ] Explain routing mechanism
  - [ ] Explain expert specialization
  - [ ] Include comparison table: token-based vs differentiable vs GMM
  - [ ] Add references to GMM_XLNET_GUIDE.md
- [ ] Create training example script (AC: 4)
  - [ ] Create `examples/train_with_gmm_memory.py`
  - [ ] Load SQuAD dataset
  - [ ] Configure GMMTrainingConfig
  - [ ] Initialize GMMXLNetForQA
  - [ ] Run training loop
  - [ ] Save checkpoint
  - [ ] Add command-line arguments
  - [ ] Add comments explaining each step
  - [ ] Test script runs without errors
- [ ] Update CLAUDE.md (AC: 5)
  - [ ] Read existing `CLAUDE.md`
  - [ ] Add GMM section to "Critical Implementation Notes"
  - [ ] Add GMM commands to "Essential Commands"
  - [ ] Update configuration section with GMM parameters
  - [ ] Add link to GMM_XLNET_GUIDE.md
- [ ] Update README.md (AC: 6)
  - [ ] Read existing `README.md`
  - [ ] Add GMM mention to features list
  - [ ] Add "Advanced Features" section if not present
  - [ ] Mention GMM as cutting-edge memory option
  - [ ] Add link to GMM_XLNET_GUIDE.md
  - [ ] Update installation/usage if needed
- [ ] Create additional examples
  - [ ] Create `examples/evaluate_gmm_model.py` - Evaluation workflow
  - [ ] Create `examples/analyze_gmm_routing.py` - Interpretability analysis
  - [ ] Add README.md to examples/ directory
- [ ] Verify documentation quality
  - [ ] Check all code examples run without errors
  - [ ] Verify all internal links work
  - [ ] Check consistent terminology throughout
  - [ ] Verify markdown formatting renders correctly
  - [ ] Run spell check
  - [ ] Verify API references match actual code
- [ ] Run integration verification (IV1-IV3)
  - [ ] Review existing docs for accuracy
  - [ ] Test all example scripts
  - [ ] Verify all links

## Dev Notes

### Documentation Structure

**New Documentation:**
```
docs/
├── guides/
│   ├── MEMORY_TOKENS_GUIDE.md         # EXTENDED
│   └── GMM_XLNET_GUIDE.md             # ✨ NEW - Primary GMM guide
├── api/
│   └── API_REFERENCE.md               # EXTENDED
├── CLAUDE.md                          # UPDATED
└── README.md                          # UPDATED

examples/
├── train_with_gmm_memory.py           # ✨ NEW
├── evaluate_gmm_model.py              # ✨ NEW
├── analyze_gmm_routing.py             # ✨ NEW (from Story 1.8)
└── README.md                          # ✨ NEW
```

### GMM_XLNET_GUIDE.md Template

**Structure:**
```markdown
# GMM-XLNet Guide

## Table of Contents

## Overview and Motivation

### The Flat Memory Problem
### Mixture-of-Experts Solution
### Comparison to Other Approaches
### Research Motivation

## Architecture Overview

### Multiple Memory Experts
### Learnable Gating Network
### Routing-Modulated Updates
### Aggregated Memory Reads
### Component Diagram

## Configuration Options

### GMMTrainingConfig Parameters
### Preset Configurations
### Configuration Examples

## Training GMM Models

### Step-by-Step Workflow
### Configuration Best Practices
### Hyperparameter Tuning
### Common Training Issues

## Evaluating GMM Models

### Evaluation Workflow
### Loading Models from Hub
### Metrics Interpretation

## Interpretability Analysis

### Using GMMAnalyzer
### Specialization Metrics
### Visualization Tools
### Interpreting Routing Patterns

## Troubleshooting

### Common Errors
### Performance Optimization
### Debugging Routing Issues
### FAQ

## References
```

### Example Script Template

```python
#!/usr/bin/env python3
"""
Train GMM-XLNet model on SQuAD v2.

Example usage:
    python examples/train_with_gmm_memory.py --num-experts 4 --epochs 3
"""

import argparse
from gmmxlnet.models import GMMXLNetForQA
from gmmxlnet.training import GMMTrainingConfig
from memxlnet.data import ChunkedSquadDataset

def main():
    # Parse arguments
    parser = argparse.ArgumentParser(description="Train GMM-XLNet model")
    parser.add_argument("--num-experts", type=int, default=4, help="Number of memory experts")
    parser.add_argument("--epochs", type=int, default=3, help="Number of training epochs")
    # ... more arguments
    args = parser.parse_args()

    # Step 1: Load dataset
    print("Loading SQuAD dataset...")
    train_dataset = ChunkedSquadDataset(split="train", ...)

    # Step 2: Configure GMM training
    print(f"Configuring GMM with {args.num_experts} experts...")
    config = GMMTrainingConfig(
        use_gmm_memory=True,
        num_memory_experts=args.num_experts,
        num_epochs=args.epochs,
        # ... more config
    )

    # Step 3: Initialize model
    print("Initializing GMMXLNetForQA...")
    model = GMMXLNetForQA(
        base_model="xlnet-base-cased",
        num_experts=args.num_experts,
        # ... more params
    )

    # Step 4: Train
    print("Starting training...")
    trainer = GMMTrainer(model, config)
    trainer.train(train_dataset)

    # Step 5: Save checkpoint
    print("Saving checkpoint...")
    model.save_pretrained("outputs/gmm-xlnet-squad")

    print("Training complete!")

if __name__ == "__main__":
    main()
```

### API Reference Format

**Entry Template:**
```markdown
### `GMMTrainingConfig`

Configuration class for GMM-XLNet training.

**Inherits from:** `TrainingConfig`

**Parameters:**

- `use_gmm_memory` (bool, default=False): Enable GMM memory system
- `num_memory_experts` (int, default=4): Number of memory experts (2-8)
- `routing_temperature` (float, default=1.0): Temperature for routing softmax
- `routing_mode` (str, default="write-based"): Routing mode ("write-based" or "read-based")
- `entropy_regularization_weight` (float, default=0.0): Weight for entropy regularization
- `load_balance_weight` (float, default=0.01): Weight for load balance loss

**Example:**

```python
from gmmxlnet.training import GMMTrainingConfig

config = GMMTrainingConfig(
    use_gmm_memory=True,
    num_memory_experts=4,
    routing_temperature=1.0,
    num_epochs=3,
)
```

**See also:** [GMM XLNet Guide](../guides/GMM_XLNET_GUIDE.md)
```

### Documentation Standards

**Writing Style:**
- Clear, concise, technical
- Explain "why" not just "what"
- Include examples for complex concepts
- Use consistent terminology
- Target audience: ML researchers and engineers

**Code Examples:**
- Runnable without modification (where possible)
- Include imports
- Include comments explaining key steps
- Show expected output where relevant

**Cross-References:**
- Link related documentation sections
- Link to API reference from guides
- Link to guides from API reference
- Use consistent link text

### Testing Documentation

**Checklist:**
- [ ] All code examples are syntactically correct
- [ ] All code examples run without errors
- [ ] All internal links resolve correctly
- [ ] All external links are valid
- [ ] Terminology is consistent
- [ ] Markdown renders correctly
- [ ] Examples cover common use cases
- [ ] Troubleshooting section addresses known issues

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-02 | 1.0 | Initial story created from PRD | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
